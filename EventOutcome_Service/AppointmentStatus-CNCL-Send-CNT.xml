<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="2d7bdaf8-f84f-4bb2-838e-c9a5c38b1abf" discardOkResults="true" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="AppointmentStatus-CNCL-Send-CNT" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="76736bd2-f070-49a7-9202-a072c143bbe3fileName">EventOutcome</con:setting><con:setting id="b0873da9-4d0c-44b1-8ca9-690267941a90fileName">AppointmentStatus-CHI-UpdateTo-CNT</con:setting><con:setting id="56d707d9-e5b7-40d2-8170-be6ee6caf965fileName">AppointmentStatus-CHI-Send-RS</con:setting><con:setting id="e3bcd866-9011-4f77-92dc-5b0a138d12d7fileName">AppointmentStatus-CHI-Send-NOS</con:setting><con:setting id="2d7bdaf8-f84f-4bb2-838e-c9a5c38b1abffileName">AppointmentStatus-CNCL-Send-CNT</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="jdbc" name="getData" id="705e9045-02c0-412b-856e-478c5b0dac1f"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>${#TestSuite#getData}</con:query><con:assertion type="XPath Match" id="3c496848-5d97-420f-84ad-d1090ebfbe7b" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" id="26f9bc46-af16-45a8-9876-3f6eedf4e9a2"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>ETS_APNTMT_ID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>getData</con:sourceStep><con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/ETS_APNTMT_ID[1]</con:sourcePath><con:targetType>ETS_APNTMT_ID</con:targetType><con:targetStep>Properties</con:targetStep><con:targetPath/><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>BKNG_ID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>getData</con:sourceStep><con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/BKNG_ID[1]</con:sourcePath><con:targetType>BKNG_ID</con:targetType><con:targetStep>Properties</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="properties" name="Properties" id="ecddb893-7810-49dc-92c5-2aa1ec856419"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>ETS_APNTMT_ID</con:name><con:value>5191208170021270</con:value></con:property><con:property><con:name>BKNG_ID</con:name><con:value>2669011</con:value></con:property><con:property><con:name>BKNG_STS_TYP_CDE</con:name><con:value>CNT</con:value></con:property><con:property><con:name>IBIS_TST_ADM_ID</con:name><con:value>20179407A</con:value></con:property><con:property><con:name>UPDATE_BKNG_STS_TYP_CDE</con:name><con:value>CNCL</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="jdbc" name="Update_AppoinmentStatus_CHI" id="4053b7f8-f9c1-4d9b-94fe-a0d85f8b43dc"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>UPDATE BKNG SET BKNG_STS_TYP_CDE = '${Properties#UPDATE_BKNG_STS_TYP_CDE}' WHERE BKNG_ID = ${Properties#BKNG_ID}</con:query><con:assertion type="XPath Match" id="0d62feb4-30b9-4485-9367-226ad43ead8b" name="Match content of [UpdateCount]"><con:configuration><path>//Results[1]/UpdateCount[1]/text()</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="restrequest" name="EventOutcome" id="047eeed5-6715-45f7-adc2-b592d9d56471"><con:settings/><con:config service="Event-Outcome-Results-Service" resourcePath="/ereg-appointment-service/rest/appointment" methodName="EventOutcome" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="EventOutcome" id="6a12dc19-22f8-43c4-87b8-a9c474ca84e2" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers"><![CDATA[<xml-fragment xmlns:con="http://eviware.com/soapui/config">
  <con:entry key="password" value="1qaz@WSX"/>
  <con:entry key="clientId" value="CRDS"/>
  <con:entry key="Accept" value="application/json"/>
  <con:entry key="programCode" value="TEL"/>
  <con:entry key="username" value="Intsyseregdvi"/>
  <con:entry key="Content-Type" value="application/json"/>
</xml-fragment>]]></con:setting></con:settings><con:endpoint>https://v2-appointment-d2d.ereg.ets.org</con:endpoint><con:request>{"appointmentRequest": {"appointment": {
   "programCode": "TEL",
   "regSysId": "ERS",
   "testAdminId":"${Properties#IBIS_TST_ADM_ID}",
   "etsAppointmentId": "${Properties#ETS_APNTMT_ID}",
   "eventCategory": "EVOCM",
   "appointmentStatus": "${Properties#BKNG_STS_TYP_CDE}",
   "transactionId": "12345678978",
   "transactionDate": "2017-04-16T06:23:55"
}}}</con:request><con:originalUri>https://v2-appointment-dev.ereg.ets.org/ereg-appointment-service/rest/appointment</con:originalUri><con:assertion type="Invalid HTTP Status Codes" id="87c10679-5058-4cbf-bc11-28f5dd174545" name="Invalid HTTP Status Codes"><con:configuration><codes>500</codes></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="d64963f5-4a64-4355-ab04-5e3b95edcf8f" name="Match content of [status]"><con:configuration><path>$['appointmentResponse']['status']</path><content>FAIL</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="f602c480-9f3e-4232-9e48-ee6a0c8f639d" name="Match content of [etsAppointmentId]"><con:configuration><path>$['appointmentResponse']['appointment']['etsAppointmentId']</path><content>${Properties#ETS_APNTMT_ID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters/><con:environmentSpec><con:entry environmentId="3324844d-b697-4f50-83fd-939b32fc138d"><con:authProfile>No Authorization</con:authProfile></con:entry><con:entry environmentId="1616f813-7e88-44f3-9295-00c26c282621"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8d9a0c7e-6293-4ea0-ae89-48b18a6caf96"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2c3ec9ec-bb1f-45d5-a8cc-50b0b05d3240"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8a20f3d0-3ddd-42c2-9e03-779de7421e8a"><con:authProfile>No Authorization</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="verify_BKNG_table" id="62b549e5-6d36-42c4-9d1d-17b055d5ed31"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT * from BKNG WHERE BKNG_ID = ${Properties#BKNG_ID}</con:query><con:assertion type="XPath Match" id="7cf0bee9-a1b7-48b8-8768-fd1ad3bd757b" name="Match content of [BKNG_STS_TYP_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/BKNG_STS_TYP_CDE[1]/text()</path><content>${Properties#UPDATE_BKNG_STS_TYP_CDE}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="697f5cc3-ab3a-4470-b059-ea1aeeecbb85" name="Match content of [DOC_ID]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/DOC_ID[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="cleanUpData" id="d51c2404-b4f1-45af-9aed-2e60099f1465"><con:settings/><con:config><script>import cleanup.EventOutcomeResultService;
EventOutcomeResultService CleanData = new EventOutcomeResultService(testRunner.testCase.testSuite.project.activeEnvironment.name);
log.info CleanData.cleanUpEventOutcome(context.expand( '${Properties#BKNG_ID}' ).toInteger());

</script></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>ef53f5cf-f9e5-43d5-8874-592bbc4beaf3</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>257141bc-cb49-46ae-a819-3218dac93951</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>b4b0244c-9272-426d-afd5-6fb2341a5f59</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="1616f813-7e88-44f3-9295-00c26c282621"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8d9a0c7e-6293-4ea0-ae89-48b18a6caf96"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2c3ec9ec-bb1f-45d5-a8cc-50b0b05d3240"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>