<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="78cf9534-437d-4717-b29a-75dcbb27e157" discardOkResults="true" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="LSD-DETECTED" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="91fe9efb-912a-4181-aa03-34a7ff5f399bfileName">NewRegistration</con:setting><con:setting id="4b2e4492-fcdb-4c56-9bea-f9eb5f72501dfileName">NewRegistration</con:setting><con:setting id="78cf9534-437d-4717-b29a-75dcbb27e157fileName">LSD-DETECTED</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="jdbc" name="getData" id="49fe86ad-14a4-438e-8dd5-f72f41f336e5" disabled="true"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT BKNG_ID,ETS_APNTMT_ID,CUST_FST_NAM FROM BKNG WHERE BKNG_ID = 392495 -- D2D
--SELECT BKNG_ID,ETS_APNTMT_ID,CUST_FST_NAM FROM BKNG WHERE BKNG_ID = 4693764
--SELECT BKNG_ID,ETS_APNTMT_ID,CUST_FST_NAM FROM BKNG WHERE CUST_FST_NAM LIKE 'cffirst%' ORDER BY DATE_CREATED DESC</con:query><con:assertion type="XPath Match" id="1fe1723d-992c-4ce9-b566-b5f156f55749" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" id="cb318b66-c97e-49cd-93e5-8bcf2b0f5155" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>ETS_APNTMT_ID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>getData</con:sourceStep><con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/ETS_APNTMT_ID[1]</con:sourcePath><con:targetType>ETS_APNTMT_ID</con:targetType><con:targetStep>Properties</con:targetStep><con:targetPath/><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>BKNG_ID</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>getData</con:sourceStep><con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/BKNG_ID[1]</con:sourcePath><con:targetType>BKNG_ID</con:targetType><con:targetStep>Properties</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="jdbc" name="getTestTakerData" id="b043a796-eec5-4e0c-babc-f2bd562ebf0f" disabled="true"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT BLC_CUSTOMER.CUSTOMER_ID,BKNG.REGN_SYS_ID AS RegistrationSystemCode, BKNG.DATE_CREATED as TransactionDate, BLC_CUSTOMER.USER_NAME AS ActiveDirectoryUserName,
ETS_CUST.LDAP_GUID_ID AS ActiveDirectoryGUID,ETS_CUST_LNKG.LNKG_KY AS CandidateID,BKNG.DATE_UPDATED AS ActivityDate,
BKNG.CUST_LST_NAM AS LastName, BKNG.CUST_FST_NAM AS FirstName,BKNG.CUST_MID_NAM AS MiddleName, BKNG.CUST_BRTH_DT AS BirthDate, ETS_CUST.GNDR_CDE AS Gender,
ETS_CUST.SSN AS SocialSecurityNumber,BLC_PHONE.PHONE_NUMBER AS PrimaryPhone,BLC_CUSTOMER.EMAIL_ADDRESS As EmailAddress, ETS_PHONE.TEL_EXTNSN_NO AS PhoneExtension,
BLC_ADDRESS.ADDRESS_ID,ETS_ADR.ADR_PRPS_CDE,BLC_ADDRESS.ADDRESS_LINE1,BLC_ADDRESS.ADDRESS_LINE2,ETS_ADR.PSTL_LN_3_ADR,ETS_ADR.PSTL_LN_4_ADR,
BLC_ADDRESS.CITY AS City,BLC_ADDRESS.STATE_PROV_REGION AS StateProvince,BLC_ADDRESS.POSTAL_CODE as PostalCode, ETS_CNTRY.ISO3_CNTRY_CDE as CountryCode,ETS_CNTRY.ISD_CDE AS PhoneCountryCode,
DECODE(ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_CDE,'NTLNG',(SELECT LANG.ISO639_LANG_CDE FROM LANG WHERE LANG.LANG_CDE = ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_VAL)) AS NativeLanguageCode,
DECODE(ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_CDE,'CTZCD', (SELECT ETS_CNTRY.ISO3_CNTRY_CDE FROM ETS_CNTRY WHERE ETS_CNTRY.CNTRY_CDE = ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_VAL)) AS CitizenshipCountryCode,
DECODE(ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_CDE,'CTRBT',(SELECT ETS_CNTRY.ISO3_CNTRY_CDE FROM ETS_CNTRY WHERE ETS_CNTRY.CNTRY_CDE = ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_VAL)) AS CountryOfBirth,
BKNG.APNTMT_DT AS AppointmentDate, TST.PGM_CDE AS TestingProgram, TST_VARTN.TST_CDE AS TestName, TST_VARTN.FUNC_CDE AS AlternateTestID
FROM 
BKNG,BLC_CUSTOMER,ETS_CUST,BLC_ADDRESS,ETS_CUST_LNKG,BLC_PHONE,BLC_CUSTOMER_PHONE,ETS_PHONE,ETS_CUST_ADTNL_INFO,ETS_ADR,ETS_CNTRY,TST,TST_VARTN
WHERE 
BKNG.CUST_FST_NAM = BLC_CUSTOMER.FIRST_NAME  AND BKNG.CUST_LST_NAM = BLC_CUSTOMER.LAST_NAME 
AND BLC_CUSTOMER.CUSTOMER_ID = ETS_CUST.CUSTOMER_ID AND ETS_CUST_LNKG.CUSTOMER_ID = BLC_CUSTOMER.CUSTOMER_ID
AND BLC_CUSTOMER_PHONE.CUSTOMER_ID = BLC_CUSTOMER.CUSTOMER_ID AND BLC_CUSTOMER_PHONE.PHONE_ID = BLC_PHONE.PHONE_ID AND BLC_CUSTOMER_PHONE.PHONE_NAME = 'primary' AND ETS_PHONE.PHONE_ID =  BLC_PHONE.PHONE_ID
AND ETS_CUST_ADTNL_INFO.CUSTOMER_ID = BLC_CUSTOMER.CUSTOMER_ID 
AND BLC_ADDRESS.FIRST_NAME = BKNG.CUST_FST_NAM AND BLC_ADDRESS.LAST_NAME = BKNG.CUST_LST_NAM
AND ETS_ADR.ADDRESS_ID = BLC_ADDRESS.ADDRESS_ID AND BLC_ADDRESS.COUNTRY = ETS_CNTRY.CNTRY_CDE AND ETS_ADR.ADR_PRPS_CDE = 'HOME'  AND ETS_CUST_ADTNL_INFO.ADTNL_INFO_TYP_CDE IN ('CTZCD','NTLNG','CTRBT')
AND BKNG.TST_ID = TST.TST_ID AND BKNG.TST_ID = TST_VARTN.TST_ID
AND BKNG.BKNG_ID = ${Properties#BKNG_ID} 
</con:query><con:assertion type="XPath Match" id="1fe1723d-992c-4ce9-b566-b5f156f55749" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="getAiDiData" id="c5503456-41d4-4011-bb08-931f5288dc48" disabled="true"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT CASE BKNG_ORG_SLCTN.SLCTN_TYP_CDE WHEN 'SELAI' THEN 'AI' ELSE 'DI' END AS Type,ORG.EXTRNL_ORG_ID AS ID,ORG.ORG_NAM AS Name,BLC_ADDRESS.POSTAL_CODE AS PostalCode,
BLC_ADDRESS.STATE_PROV_REGION AS StateCode,ORG_SB_TYP.ORG_SB_TYP_CDE AS DeptCode 
FROM BKNG_ORG_SLCTN,ORG,BLC_ADDRESS,ORG_SB_TYP,BKNG ,ORG_ADR,ETS_CUST,BLC_CUSTOMER
WHERE 
BKNG_ORG_SLCTN.BKNG_ID = BKNG.BKNG_ID AND BKNG.CUST_FST_NAM = BLC_CUSTOMER.FIRST_NAME  AND BKNG.CUST_LST_NAM = BLC_CUSTOMER.LAST_NAME 
AND BLC_CUSTOMER.CUSTOMER_ID = ETS_CUST.CUSTOMER_ID AND BKNG_ORG_SLCTN.ORG_ID_NO  = ORG.ORG_ID_NO AND ORG_ADR.ORG_ID_NO = BKNG_ORG_SLCTN.ORG_ID_NO 
AND ORG_ADR.ADDRESS_ID = BLC_ADDRESS.ADDRESS_ID AND BKNG_ORG_SLCTN.ORG_SB_TYP_ID = ORG_SB_TYP.ORG_SB_TYP_ID AND BKNG.BKNG_ID = ${Properties#BKNG_ID} 
</con:query><con:assertion type="XPath Match" id="1fe1723d-992c-4ce9-b566-b5f156f55749" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="getTestSiteData" id="adc34b40-cb92-4d94-91b4-3b513748c53e" disabled="true"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT ORG.EXTRNL_ORG_ID AS SITE_ID,ORG.ORG_NAM AS Name,BKNG.TM_ZN_OFST_QTY AS TimeZoneOffset, BLC_ADDRESS.ADDRESS_LINE1 AS SITE_ADDRESS_LINE1,
BLC_ADDRESS.ADDRESS_LINE2 AS SITE_ADDRESS_LINE2,ETS_ADR.PSTL_LN_3_ADR AS SITE_ADDRESS_LINE3,ETS_ADR.PSTL_LN_4_ADR AS SITE_ADDRESS_LINE4,
BLC_ADDRESS.CITY AS SITE_City,BLC_ADDRESS.COUNTY AS COUNTY, BLC_ADDRESS.STATE_PROV_REGION AS SITE_StateProvince,BLC_ADDRESS.POSTAL_CODE as SITE_PostalCode, ETS_CNTRY.ISO3_CNTRY_CDE as SITE_CountryCode
FROM 
BKNG,ORG,ORG_ADR,BLC_ADDRESS,ETS_ADR,ETS_CNTRY
WHERE 
BKNG.TST_CNTR_ID_NO = ORG.ORG_ID_NO AND ORG.ORG_ID_NO = ORG_ADR.ORG_ID_NO AND ORG_ADR.ADDRESS_ID = BLC_ADDRESS.ADDRESS_ID AND ETS_ADR.ADDRESS_ID = ORG_ADR.ADDRESS_ID
AND BLC_ADDRESS.COUNTRY = ETS_CNTRY.CNTRY_CDE
AND BKNG.BKNG_ID = ${Properties#BKNG_ID} 
</con:query><con:assertion type="XPath Match" id="1fe1723d-992c-4ce9-b566-b5f156f55749" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="getFilePath" id="90b700d0-4de8-437e-8a1f-fa01db3e0599" disabled="true"><con:settings/><con:config><script>import util.RestClient;
RestClient client = new RestClient();

def eTS_APNTMT_ID = context.expand( '${Properties#ETS_APNTMT_ID}' )

def environment = context.expand( '${Environment}' )

def filepath =  client.getFilePath( environment, eTS_APNTMT_ID ,"New","request");
log.info filepath
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("filepath",filepath);
testRunner.testCase.getTestStepByName("Properties").setPropertyValue("env",environment);
</script></con:config></con:testStep><con:testStep type="properties" name="Properties" id="d6c303b4-b806-41d2-af1e-ab6788408d91"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>filepath</con:name><con:value>/20171003/1600/_RAServiceCall_EXTRCTID_543000_BOOKINGID_392740_2017-10-03_16-01-14.220_response.xml</con:value></con:property><con:property><con:name>ETS_APNTMT_ID</con:name><con:value>7946811170017722</con:value></con:property><con:property><con:name>BKNG_ID</con:name><con:value>392740</con:value></con:property><con:property><con:name>env</con:name><con:value>D2D</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="restrequest" name="LSD-DETECTED" id="80e697aa-1fbc-4cbc-8e5a-a0df2bdfc784"><con:settings/><con:config service="Server-Logs-Url" resourcePath="/{env}/LSDService{filepath}" methodName="" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="LSD-DETECTED" id="b8c9f4b0-eaa3-4e20-8099-661fb0f46dac" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding xsi:nil="true"/><con:request/><con:originalUri>https://etsvcln0938.etslan.org/ATSBatch/</con:originalUri><con:assertion type="XPath Match" id="3c76acc2-b64c-42bc-85a1-03da6c4071e2" name="Match content of [ns2:programCode]"><con:configuration><path>declare namespace ns2='http://www.ets.org/schema/RAServices/LSDResponse';
//ns2:getLSDdataForAnAppointmentResponse[1]/ns2:programCode[1]/text()</path><content>TEL</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="b95f420c-7473-4759-9574-8187d33e18dd" name="Match content of [ns2:testAbbreviation]"><con:configuration><path>declare namespace ns2='http://www.ets.org/schema/RAServices/LSDResponse';
//ns2:getLSDdataForAnAppointmentResponse[1]/ns2:testAbbreviation[1]/text()</path><content>XML</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="5aa000e2-2da0-4d2e-ac00-65e3d4c16403" name="Match content of [ns2:regSysId]"><con:configuration><path>declare namespace ns2='http://www.ets.org/schema/RAServices/LSDResponse';
//ns2:getLSDdataForAnAppointmentResponse[1]/ns2:appointments[1]/ns2:appointmentInfo[1]/ns2:regSysId[1]/text()</path><content>ERS</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters>
  <con:entry key="filepath" value="${Properties#filepath}"/>
  <con:entry key="env" value="${Properties#env}"/>
</con:parameters><con:parameterOrder><con:entry>filepath</con:entry><con:entry>env</con:entry></con:parameterOrder><con:environmentSpec><con:entry environmentId="1616f813-7e88-44f3-9295-00c26c282621"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8d9a0c7e-6293-4ea0-ae89-48b18a6caf96"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2c3ec9ec-bb1f-45d5-a8cc-50b0b05d3240"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8a20f3d0-3ddd-42c2-9e03-779de7421e8a"><con:authProfile>No Authorization</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="Verify_BKNG_ANLYS_RSLT_table" id="d315cb2b-aef1-48ce-8e92-ace042040911"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT * FROM BKNG_ANLYS_RSLT WHERE BKNG_ID = ${Properties#BKNG_ID}</con:query><con:assertion type="XPath Match" id="1fe1723d-992c-4ce9-b566-b5f156f55749" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="4d979420-fdfc-4486-b24b-94e0dbcafecf" name="Match content of [BKNG_ANLYS_TYP_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/BKNG_ANLYS_TYP_CDE[1]/text()</path><content>LSDD</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>aee8ebb8-0546-4410-8f27-3b304d18fde8</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>efab2a0b-74a5-4ea5-b897-b0385603f249</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ef834dda-63e7-4dee-a143-120bad65c116</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>27b19dc0-607b-46c0-89e1-c2c1aa029175</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>feb1d957-e430-427e-a5c8-a9e39625e289</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>8269c0c7-b05d-4f79-b51e-9eff3b0828da</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>1c29ff33-858e-48f7-9359-29480d7eb241</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>7d85968f-50ff-4a7d-9798-1a7fa460c52c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>f31dce47-5088-481c-912e-5c196ffc1da4</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>184338d1-d8d8-48e6-ae00-00eba3554e5f</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="1616f813-7e88-44f3-9295-00c26c282621"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8d9a0c7e-6293-4ea0-ae89-48b18a6caf96"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2c3ec9ec-bb1f-45d5-a8cc-50b0b05d3240"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>