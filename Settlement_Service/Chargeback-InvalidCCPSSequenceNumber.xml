<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="db5b5fdd-4e39-43d1-a8e1-29893c81e792" discardOkResults="true" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="Chargeback-InvalidCCPSSequenceNumber" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="db5b5fdd-4e39-43d1-a8e1-29893c81e792fileName">Chargeback-InvalidCCPSSequenceNumber</con:setting></con:settings><con:savedRecentRuns>1</con:savedRecentRuns><con:testStep type="jdbc" name="getData" id="cef64ad3-21fd-4e5c-8a1a-53d72079bfc1"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>${#TestSuite#getData_Original}</con:query><con:assertion type="XPath Match" id="3c496848-5d97-420f-84ad-d1090ebfbe7b" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" id="f7e096f7-1c9f-435a-b249-23a7ab2f2359"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>order_id</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>getData</con:sourceStep><con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/ORDER_ID[1]</con:sourcePath><con:targetType>ORDER_ID</con:targetType><con:targetStep>Properties</con:targetStep><con:upgraded>true</con:upgraded></con:transfers><con:transfers setNullOnMissingSource="true" transferTextContent="true" failOnError="true" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="false"><con:name>osc_code</con:name><con:sourceType>ResponseAsXml</con:sourceType><con:sourceStep>getData</con:sourceStep><con:sourcePath>//Results[1]/ResultSet[1]/Row[1]/ORGNTG_SYS_CDE[1]</con:sourcePath><con:targetType>OSC_CODE</con:targetType><con:targetStep>Properties</con:targetStep><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="properties" name="Properties" id="865d6eea-ba27-4fe0-848a-991ae17a59b5"><con:settings/><con:config xsi:type="con:PropertiesStep" saveFirst="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:properties><con:property><con:name>ORDER_ID</con:name><con:value>255858</con:value></con:property><con:property><con:name>RECONCILE_ID</con:name><con:value>99999999</con:value></con:property><con:property><con:name>TRANSACTION_CODE</con:name><con:value>245</con:value></con:property><con:property><con:name>SETTLEMENT_AMOUNT</con:name><con:value>170</con:value></con:property><con:property><con:name>OUTSTND_BAL_RSN_TYP_CDE</con:name><con:value>CBAPP</con:value></con:property><con:property><con:name>AUTHORIZATION_CODE</con:name><con:value>tst332</con:value></con:property><con:property><con:name>PAYMENT_ID</con:name><con:value>V</con:value></con:property><con:property><con:name>OSC_CODE</con:name><con:value>ERT</con:value></con:property></con:properties></con:config></con:testStep><con:testStep type="restrequest" name="Chargeback" id="47e3de99-7579-47af-98b0-b8b3d7468c6d"><con:settings/><con:config service="SettlementService" resourcePath="/ereg-ecommerce-service/rest/settlement" methodName="Settlement" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="Chargeback" id="69430ff1-8a36-478f-a854-ae5372b0b236" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="password" value="1qaz@WSX"/>
  &lt;con:entry key="username" value="Intsyseregdvi"/>
&lt;/xml-fragment></con:setting></con:settings><con:request>{"settlementDetails": {
   "oscCode": "${Properties#OSC_CODE}",
   "projectNumber": "02011",
   "modeOfReceipt": "N",
   "modeOfAuthorization": "R",
   "transactionCode": "${Properties#TRANSACTION_CODE}",
   "programSpecificKey": "21289",
   "serviceCode": "",
   "programDefinedDate": "",
   "statementText": "ETS*TOEFL",
   "ccAccountNumber": "4444444444444448",
   "amount": "000${Properties#SETTLEMENT_AMOUNT}00",
   "cardExpirationDate": "0717",
   "shiptoCustomerName": "sfirstnyld slastnyld",
   "responseCode": "100",
   "approvalCode": "Y",
   "authorizationCode": "${Properties#AUTHORIZATION_CODE}",
   "authorizationDate": "${#TestSuite#previousDay}",
   "ccpsSeqenceNumber": "${Properties#RECONCILE_ID}",
   "recordCode": "2",
   "reasonCode": "",
   "transCount": "",
   "merchantID": "210745",
   "expirationFlag": "",
   "ccpsDate": "${#TestSuite#currentDay}",
   "subscriptionIndicator": "",
   "subscriptionFrequency": "",
   "candidateStreetAddress": "1825 nyld Test Drive",
   "candidateZipCode": "08618",
   "candidateCityState": "Somerset         NJ",
   "paymentID": "${Properties#PAYMENT_ID}",
   "billtoName": "sfirstnyld slastnyld",
   "billtoAddress": "301 Main Street",
   "billtoCity": "Princeton",
   "billtoState": "NJ",
   "billtoZipCode": "08618",
   "billtoCountry": "US",
   "billtoPhone": "",
   "candidateShipToCountry": "US",
   "candidateShipToPhone": "",
   "customerIPAddress": "",
   "aliasAccountNumber": "4444444444444448",
   "bankID": "",
   "accountType": "",
   "checkNumber": "",
   "currencyCode": "USD",
   "productID": "",
   "activityID": "",
   "resourceType": "",
   "cvvResultCode": "M",
   "eCommerceType": "02",
   "cavvResponseCode": "",
   "cavvOrAav": "",
   "avsResponseCode": "I3",
   "bmlCustomeType": "",
   "cvvResponseCode": "0",
   "bmltcVersion": "",
   "cpmAddressMatch": "Y",
   "cpmZipMatch": "Y",
   "convertFlag": "",
   "paylinxFlag": "",
   "jeAccountNumber": "",
   "ecIndicator": "",
   "customerEmailAddress": "",
   "submissionDate": "",
   "presentmentCurrency": "USD",
   "presentmentAmount": "0000000000${Properties#SETTLEMENT_AMOUNT}00",
   "presentmentRate": "00001000000000000",
   "quoted": "000000000000000000000000000000",
   "settlementCurrency": "USD",
   "settlementAmount": "000${Properties#SETTLEMENT_AMOUNT}00",
   "fxRate": "00001000000000000"
}}</con:request><con:originalUri>https://etsvcln0502.etslan.org/ereg-external-service/rest/settlement</con:originalUri><con:assertion type="JsonPath Match" id="0bc5846b-d26d-4f8a-b44c-6ddd448c8345" name="Match content of [status]"><con:configuration><path>$['settlementStatus']['status']</path><content>FAIL</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="JsonPath Match" id="e57382fa-f6a0-4159-ab6b-3f105c4c33d8" name="Match content of [ccpsSequenceNumber]"><con:configuration><path>$['settlementStatus']['ccpsSequenceNumber']</path><content>${Properties#RECONCILE_ID}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:parameters/><con:parameterOrder/><con:environmentSpec><con:entry environmentId="5c76c1c8-0b52-4c16-a576-30e5ec0e03e3"><con:authProfile>Inherit From Parent</con:authProfile><con:username>Intsyseregdvi</con:username><con:password>1qaz@WSX</con:password></con:entry><con:entry environmentId="1ccf3773-9147-4d54-bde6-0a0d51cf0dc9"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="6fa21fd6-44cd-4205-8da4-3101c05ad03c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="f12c4994-a8db-4990-a68d-d870bd12d905"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2b8fba5b-5c5b-428d-9440-759996aee5d8"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a460b8c8-0001-43c9-83dc-a512938f0f0b"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="132cfe1b-104a-46ae-8409-8d3204f2e9a0"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="3c247fad-11ea-48df-9244-ccc1c452c36f"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="3324844d-b697-4f50-83fd-939b32fc138d"><con:authProfile>No Authorization</con:authProfile></con:entry><con:entry environmentId="1616f813-7e88-44f3-9295-00c26c282621"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8d9a0c7e-6293-4ea0-ae89-48b18a6caf96"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2c3ec9ec-bb1f-45d5-a8cc-50b0b05d3240"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8a20f3d0-3ddd-42c2-9e03-779de7421e8a"><con:authProfile>No Authorization</con:authProfile></con:entry></con:environmentSpec></con:restRequest></con:config></con:testStep><con:testStep type="jdbc" name="verify_PYMT_TRNSCTN_table" id="5822a095-30f6-47c0-8a14-db0566740542"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT * FROM PYMT_TRNSCTN WHERE ORDER_ID = ${Properties#ORDER_ID} ORDER BY DATE_CREATED ASC</con:query><con:assertion type="XPath Match" id="3c496848-5d97-420f-84ad-d1090ebfbe7b" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)>0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="0a078bd2-158f-467e-9771-68a6361f50fc" name="Match content of [PYMT_TRNSCTN_STS_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/PYMT_TRNSCTN_STS_CDE[1]/text()</path><content>X</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="e9f78442-dd9e-4101-97db-c9bb96570365" name="Match content of [STLMNT_TRNSCTN_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_TRNSCTN_CDE[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="da87fdfc-3706-428c-a209-354f4d6d936b" name="Match content of [STLMNT_AMT]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_AMT[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="555581c0-d39f-4c0d-a91d-a5f8a45cfdae" name="Match content of [STLMNT_RSP_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_RSP_CDE[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="7ec61b57-66e1-4418-8f1c-58ca78f10bd5" name="Match content of [STLMNT_APRVL_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_APRVL_CDE[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="6cd8a9fa-fbd1-42e0-a1c4-8d98823c9593" name="Match content of [STLMNT_AUTH_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_AUTH_CDE[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="dc138a20-1cd0-4be4-9b9c-5da407988426" name="Match content of [STLMNT_AUTH_DTE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_AUTH_DTE[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="c8326516-d3df-4611-8423-f6d45c8b271f" name="Match content of [CCPS_SEQ_NO]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/CCPS_SEQ_NO[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="9029ae87-2f8a-40f2-abb5-5e4b6e175b57" name="Match content of [STLMNT_RCD_CDE]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_RCD_CDE[1]/text()</path><content>${New#Request#$['settlementDetails']['recordCode']}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="3459936f-9ace-4034-b7d3-4dbc622b6e07" name="Match content of [STLMNT_PYMT_ID]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_PYMT_ID[1]/text()</path><content>${New#Request#$['settlementDetails']['paymentID']}</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="fbafb248-f9ef-4aa6-ba4f-26f5cb0a365f" name="Match content of [STLMNT_FGN_EXCHG_RT]"><con:configuration><path>//Results[1]/ResultSet[1]/Row[1]/STLMNT_FGN_EXCHG_RT[1]/text()</path><content/><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="eab828d2-0b60-440e-86b1-9b837f48f213" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)</path><content>1</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="jdbc" name="verify_CUST_OUTSTND_BAL_table" id="a47b9a71-393b-4776-a56f-a3c7e71b1fc0"><con:settings><con:setting id="prettyPrintResponse">true</con:setting></con:settings><con:config xsi:type="con:JdbcRequestTestStep" convertColumnNamesToUpperCase="true" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:driver>${DB-Driver}</con:driver><con:connectionString>${Database}</con:connectionString><con:password/><con:query>SELECT * FROM CUST_OUTSTND_BAL WHERE ORDER_ID = ${Properties#ORDER_ID}</con:query><con:assertion type="XPath Match" id="3c496848-5d97-420f-84ad-d1090ebfbe7b" name="Check count of [Row]"><con:configuration><path>count( //Results/ResultSet/Row)=0</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:properties/></con:config></con:testStep><con:testStep type="groovy" name="dataCleanUp" id="7d8725df-fc8c-43b5-8f5e-a16089b3b549"><con:settings/><con:config><script>import cleanup.SettlementService;
SettlementService CleanData = new SettlementService(testRunner.testCase.testSuite.project.activeEnvironment.name);
log.info CleanData.chargeBack(context.expand( '${Properties#ORDER_ID}' ).toInteger());</script></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>7936aa8e-8f46-4883-b5b3-08153921b943</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>08179e8a-0b0f-4994-8f1b-1eb1750ea98d</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>24e09d12-fbf4-4440-9ded-068464d7706f</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d820b229-8e2c-44a9-adaf-154142e1c386</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>7ee94f28-6cf0-40c8-b08f-8756b1f93ec2</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>0ac40235-1525-45fb-b270-239ac4e02310</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>52bfecad-c834-4140-8210-fd2100164764</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>46de8e6d-c4e5-4d6d-a7b3-caedd4f39fca</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="1ccf3773-9147-4d54-bde6-0a0d51cf0dc9"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="6fa21fd6-44cd-4205-8da4-3101c05ad03c"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="f12c4994-a8db-4990-a68d-d870bd12d905"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2b8fba5b-5c5b-428d-9440-759996aee5d8"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="a460b8c8-0001-43c9-83dc-a512938f0f0b"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="132cfe1b-104a-46ae-8409-8d3204f2e9a0"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="3c247fad-11ea-48df-9244-ccc1c452c36f"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="1616f813-7e88-44f3-9295-00c26c282621"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="8d9a0c7e-6293-4ea0-ae89-48b18a6caf96"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="2c3ec9ec-bb1f-45d5-a8cc-50b0b05d3240"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>